!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).BGE={})}(this,(function(t){"use strict";const e={OK:0,FAILED:1,PIECE_TYPE_INVALID:2,NO_PIECE_AVAIBLE:3,OUT_OF_BOUNDS:4,ALREADY_SHOOT:5,NOT_IN_GAMESTATE:6};class i{constructor(t){this.CellState={Empty:0,PieceMiddleHorizontal:1,PieceMiddleVertical:2,PieceLeft:3,PieceRight:4,PieceTop:5,PieceBottom:6,Miss:7,Hit:8},this.PieceType={Destroyer:2,Cruiser:3,Submarine:3,Battleship:4,Carrier:5},this.size=t,this.primaryGrid=[],this.trackingGrid=[],this.piecesAvailable=[];for(let t=0;t<this.size;t++){this.primaryGrid.push([]),this.trackingGrid.push([]);for(let e=0;e<this.size;e++)this.primaryGrid[t].push(0),this.trackingGrid[t].push(0)}}init(){this.piecesAvailable=["Destroyer","Cruiser","Submarine","Battleship","Carrier"];for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)this.primaryGrid[t][e]=this.CellState.Empty,this.trackingGrid[t][e]=this.CellState.Empty}print(t=""){switch(t){case"tracking":case"t":this._printTrackingGrid();break;case"primary":case"p":this._printPrimaryGrid();break;default:this._printTrackingGrid(),this._printPrimaryGrid()}}placePiece(t,i,r,s){if(!this.PieceType[t])throw e.PIECE_TYPE_INVALID;let a=this.piecesAvailable.indexOf(t);if(-1==a)throw e.NO_PIECE_AVAIBLE;if(i<0||i>=this.size||r<0||r>=this.size)throw e.OUT_OF_BOUNDS;let h=this.PieceType[t],l=Math.ceil(h/2)-1;if("horizontal"==s||"h"==s){if(i=Math.max(Math.min(i,this.size-(h-l)),l),r=Math.max(Math.min(r,this.size-1),0),i-l>=0&&i+(h-l)<=this.size){for(let t=0;t<h;t++)if(this._isCellOccupied(i-l+t,r))return!1;for(let t=0;t<h;t++)this.primaryGrid[r][i-l+t]=0==t?this.CellState.PieceLeft:t==h-1?this.CellState.PieceRight:this.CellState.PieceMiddleHorizontal;return this.piecesAvailable.splice(a,1),!0}}else if(("vertical"==s||"v"==s)&&(i=Math.max(Math.min(i,this.size-1),0),(r=Math.max(Math.min(r,this.size-(h-l)),l))-l>=0&&r+(h-l)<=this.size)){for(let t=0;t<h;t++)if(this._isCellOccupied(i,r-l+t))return!1;for(let t=0;t<h;t++)this.primaryGrid[r-l+t][i]=0==t?this.CellState.PieceTop:t==h-1?this.CellState.PieceBottom:this.CellState.PieceMiddleVertical;return this.piecesAvailable.splice(a,1),!0}return!1}shoot(t,i,r){if(t._isCellBeenShoot(i,r))throw e.ALREADY_SHOOT;return t._isCellOccupied(i,r)?(this.trackingGrid[r][i]=this.CellState.Hit,t.primaryGrid[r][i]=this.CellState.Hit,!0):(this.trackingGrid[r][i]=this.CellState.Miss,t.primaryGrid[r][i]=this.CellState.Miss,!1)}getAlives(){let t=0;for(let e=0;e<this.size;e++)for(let i=0;i<this.size;i++)this._isCellOccupied(i,e)&&(t+=1);return t}_isCellOccupied(t,e){return this.primaryGrid[e][t]==this.CellState.PieceMiddleHorizontal||this.primaryGrid[e][t]==this.CellState.PieceMiddleVertical||this.primaryGrid[e][t]==this.CellState.PieceLeft||this.primaryGrid[e][t]==this.CellState.PieceRight||this.primaryGrid[e][t]==this.CellState.PieceTop||this.primaryGrid[e][t]==this.CellState.PieceBottom}_isCellBeenShoot(t,i){if(t<0||t>=this.size||i<0||i>=this.size)throw e.OUT_OF_BOUNDS;return this.primaryGrid[i][t]==this.CellState.Hit||this.primaryGrid[i][t]==this.CellState.Miss}_printPrimaryGrid(){this._printGrid(this.primaryGrid,"SHIPS","bottom")}_printTrackingGrid(){this._printGrid(this.trackingGrid,"TRACKING","top")}_printGrid(t,e,i){let r="";if(""!=e&&(""==i||"top"==i)){r+=" ".repeat(this.size-Math.ceil(e.length/2)+4)+e+" ".repeat(this.size-Math.floor(e.length/2)),r+="\n",r+="    ";for(let t=0;t<this.size;t++)r+=t+" ";r+="\n"}for(let e=0;e<this.size;e++){0==e&&(r+="  ╔"+"═".repeat(2*this.size+1)+"╗\n");for(let i=0;i<this.size;i++)0==i&&(r+=e+" ║ "),r+=this._cellToChar(t[e][i])+" ",i==this.size-1&&(r+="║");r+="\n",e==this.size-1&&(r+="  ╚"+"═".repeat(2*this.size+1)+"╝")}if(""!=e&&"bottom"==i){r+="\n",r+="    ";for(let t=0;t<this.size;t++)r+=t+" ";r+="\n",r+=" ".repeat(this.size-Math.ceil(e.length/2)+4)+e+" ".repeat(this.size-Math.floor(e.length/2))}console.log(r)}_cellToChar(t){switch(t){case this.CellState.Empty:return" ";case this.CellState.PieceMiddleHorizontal:case this.CellState.PieceMiddleVertical:return"■";case this.CellState.PieceLeft:return"◄";case this.CellState.PieceRight:return"►";case this.CellState.PieceTop:return"▲";case this.CellState.PieceBottom:return"▼";case this.CellState.Miss:return"·";case this.CellState.Hit:return"x";default:return"?"}}}t.Board=i,t.Error=e,t.Game=class{constructor(){this.GameState={Waiting:0,GameStart:1,PlayerTurn:2,ComputerTurn:3,GameOver:4},this.stats={},this.gameState=this.GameState.Waiting,this.playerBoard=new i(8),this.computerBoard=new i(8),this.gameWinner=0,this.onGameover}startGame(){return this.stats={turns:0,alives:0,hits:0,misses:0},this.gameWinner=0,this.gameState=this.GameState.GameStart,this.playerBoard.init(),this.computerBoard.init(),this.placeRandom(this.computerBoard),this.playerBoard.primaryGrid}startTurn(){if(this.gameState!=this.GameState.GameStart)throw e.NOT_IN_GAMESTATE;return this.placeRandom(this.playerBoard),this.placeRandom(this.computerBoard),this.stats.alives=this.playerBoard.getAlives(),this.gameState=this.GameState.PlayerTurn,this.playerBoard.primaryGrid}place(t,i,r,s,a){if(this.gameState!=this.GameState.GameStart)throw e.NOT_IN_GAMESTATE;try{return t.placePiece(i,r,s,a)}catch(t){throw t}}placeRandom(t){if(this.gameState!=this.GameState.GameStart)throw e.NOT_IN_GAMESTATE;for(;t.piecesAvailable.length>0;){let e=Math.round(Math.random())?"h":"v",i=Math.floor(8*Math.random())%8,r=Math.floor(8*Math.random())%8;t.placePiece(t.piecesAvailable[0],i,r,e)}}shoot(t,i){if(this.gameState!=this.GameState.PlayerTurn)throw e.NOT_IN_GAMESTATE;try{let e=this.playerBoard.shoot(this.computerBoard,t,i);return this.gameState=this.GameState.ComputerTurn,e?(this.stats.hits+=1,this.computerBoard.getAlives()<=0&&(this.gameWinner=1,this.gameState=this.GameState.GameOver,this.onGameover&&"function"==typeof this.onGameover&&this.onGameover(this.gameWinner))):this.stats.misses+=1,e}catch(t){throw t}}computerShoot(){if(this.gameState!=this.GameState.ComputerTurn)throw e.NOT_IN_GAMESTATE;for(;;)try{let t=Math.floor(8*Math.random())%8,e=Math.floor(8*Math.random())%8,i=this.computerBoard.shoot(this.playerBoard,t,e);return this.gameState=this.GameState.PlayerTurn,this.stats.turns+=1,this.stats.alives=this.playerBoard.getAlives(),i&&this.stats.alives<=0&&(this.gameWinner=2,this.gameState=this.GameState.GameOver,this.onGameover&&"function"==typeof this.onGameover&&this.onGameover(this.gameWinner)),{x:t,y:e,result:i}}catch(t){}}getAlives(t){if(this.gameState!=this.GameState.PlayerTurn||this.gameState!=this.GameState.ComputerTurn)throw e.NOT_IN_GAMESTATE;return t.getAlives()}},Object.defineProperty(t,"__esModule",{value:!0})}));